<!DOCTYPE html><html><head><title>Smart Pointers</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><link rel="stylesheet" type="text/css" href="../style/slidedeckalpha.css"><link rel="stylesheet" href="../code.css"><script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script><script type="text/javascript">
hljs.initHighlightingOnLoad();


</script></head><body><section><div class="bigtitle"><div class="title"><strong>Smart Pointers</strong></div><div class="presenter">Brian Kidney</div></div><footer><a href="http://localhost:1313/presentations/acu-smart-pointers/slides/">http://localhost:1313/presentations/acu-smart-pointers/slides/</a></footer></section><p><section>
	<h1 class="slidetitle">A wise man said...</h1>
	<blockquote>
<p>&ldquo;In C++ it&rsquo;s harder to shoot yourself in the foot, but when you do, you blow off your whole leg.&rdquo;    â€” Bjarne Stroustrup.</p>
</blockquote>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Smart Pointers</h1>
	<ul>
<li>Until recently we had &ldquo;new&rdquo; and &ldquo;delete&rdquo;</li>
<li>We also had

<ul>
<li>Owership decisions (who calls delete?)</li>
<li>Memory leaks</li>
</ul></li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Smart Pointers</h1>
	<ul>
<li>Smart pointers replace &ldquo;new&rdquo; and &ldquo;delete&rdquo;

<ul>
<li>In most cases</li>
</ul></li>
<li>Remove memory management burden</li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Types of Smart Pointers</h1>
	<ul>
<li>unique_ptr

<ul>
<li>When in doubt its the default</li>
<li>Can be moved but not copied</li>
</ul></li>
<li>shared_ptr

<ul>
<li>For pointers that will be shared</li>
<li>Only use is sharing need is known</li>
<li>unique_ptr can be converted to shared_ptr</li>
</ul></li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Types of Smart Pointers</h1>
	<ul>
<li>weak_ptr

<ul>
<li>Copy from a shared_ptr</li>
<li>Made empty by distruction of shared_ptr</li>
<li>Can be used to break a circular reference</li>
</ul></li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Types of Smart Pointers</h1>
	<ul>
<li>auto_ptr

<ul>
<li>Attempt from previous standard without move semantics</li>
<li>Majority of uses can be converted to unique_ptr</li>
</ul></li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Examples - unique_ptr</h1>
	<pre class="code"><code class="cpp">

  // Creating a Unique Pointer
  std::unique_ptr&lt;int&gt; the_answer 
    = std::make_unique&lt;int&gt;(42);
  std::cout << "Creation..." << std::endl;
  std::cout << " the_answer.get() = " 
    << the_answer.get() << std::endl;
  std::cout << "*the_answer = " 
    << *the_answer << std::endl;
  
</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Examples - unique_ptr</h1>
	<pre class="code"><code class="cpp">

  // Copying a Unique Pointer is not allowed
  // std::unique_ptr&lt;int&gt; forty_two = the_answer;
  
  // Moving a Unique Pointer
  std::unique_ptr&lt;int&gt; forty_two  
    = std::move(the_answer);
  std::cout << "After move..." << std::endl;
  std::cout << " the_answer.get() = " 
    << the_answer.get() << std::endl;
  std::cout << "*the_answer = " 
    << std::endl; //<< *the_answer << std::endl;
  std::cout << " forty_two.get() = " 
    << forty_two.get() << std::endl;
  std::cout << "*forty_two = " 
    << *forty_two << std::endl;

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Examples - unique_ptr</h1>
	<pre class="code"><code class="txt">
Creation...
  the_answer.get() = 0x7faf30403b80
  *the_answer = 42
After move...
  the_answer.get() = 0x0
  *the_answer =
  forty_two.get() = 0x7faf30403b80
  *forty_two = 42
</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Examples - unique_ptr</h1>
	<pre class="code"><code class="cpp">

  // Releasing the pointer
  forty_two.reset();
  std::cout << "After reset..." 
    << std::endl;
  std::cout << " forty_two.get() = " 
    << forty_two.get() << std::endl;
  std::cout << "*forty_two = " 
    << std::endl; // << *forty_two << std::endl;

</code></pre>

<pre class="code"><code class="txt">

After reset...
 forty_two.get() = 0x0
 *forty_two =

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Ex - shared_ptr and weak_ptr</h1>
	<pre class="code"><code class="cpp">

  // Move to shared
  std::unique_ptr&lt;Point2d&gt; point 
    = std::make_unique&lt;Point2d&gt;(4, 2);
  std::cout << "Creation (again)..." << std::endl;
  std::cout << "point.get() = " 
    << point.get() << std::endl;
  std::cout << "*point = "
    << "(" << point->x << ", " << point->y << ")" 
    << std::endl;

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Ex - shared_ptr and weak_ptr</h1>
	<pre class="code"><code class="cpp">


  std::shared_ptr&lt;Point2d&gt; 
    shared_point(std::move(point));
  std::cout << "Moved to shared pointer..." 
    << std::endl;
  std::cout << "point.get() = " << point.get() 
    << std::endl;
  std::cout << "*point = " << std::endl ;
    //<< "(" << *point.x << ", " *point.y << ")" 
    //<< std::endl;
  std::cout << "shared_point.get() = " 
    << shared_point.get() << std::endl;
  std::cout << "*shared_point = "
    << "(" << shared_point->x << ", "
    <<  shared_point->y << ")" << std::endl;

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Ex - shared_ptr and weak_ptr</h1>
	<pre class="code"><code class="txt">


Creation (again)...
point.get() = 0x7fb01bc03b80
*point = (4, 2)
Moved to shared pointer...
point.get() = 0x0
*point =
shared_point.get() = 0x7fb01bc03b80
*shared_point = (4, 2)

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Ex - shared_ptr and weak_ptr</h1>
	<pre class="code"><code class="cpp">

  // Create a weak pointer
  std::weak_ptr&lt;Point2d&gt; weak_point 
    = shared_point;
  std::cout << "Create a weak pointer..." 
    << std::endl;
  std::cout << "weak_point.expired() =  "
    << (weak_point.expired() ? "true" : "false")  
    << std::endl;

  shared_point.reset();
  std::cout << "After Shared Pointer is Reset..." 
    << std::endl;
  std::cout << "shared_point.get() = " 
    << shared_point.get() << std::endl;
  std::cout << "weak_point.expired() =  "
    << (weak_point.expired() ? "true" : "false")  
    << std::endl;

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Ex - shared_ptr and weak_ptr</h1>
	<pre class="code"><code class="txt">


Create a weak pointer...
weak_point.expired() =  false
After Shared Pointer is Reset...
shared_point.get() = 0x0
weak_point.expired() =  true

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">What about Raw Pointers?</h1>
	<ul>
<li>Low level data structures

<ul>
<li>For performance, maybe?</li>
</ul></li>
<li>Non-owning pointers and reference

<ul>
<li>Pass to a function with limited lifecycle</li>
</ul></li>
<li>Observer to an object with a longer life</li>
</ul>

</section>
</p>

<p><section>
	<h1 class="slidetitle">Examples - Raw Pointer</h1>
	<pre class="code"><code class="cpp">

// herbsutter.com/elements-of-modern-c-style/
class node {
 vector<unique_ptr<node>> children;
 node* parent;
public:
 :::
};

</code></pre>

</section>
</p>

<p><section>
	<h1 class="slidetitle">References</h1>
	<ul>
<li><a href="http://herbsutter.com/elements-of-modern-c-style/">http://herbsutter.com/elements-of-modern-c-style/</a></li>
<li><a href="http://herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/">http://herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/</a></li>
<li><a href="https://www.youtube.com/watch?v=xnqTKD8uD64">https://www.youtube.com/watch?v=xnqTKD8uD64</a></li>
</ul>

</section>
</p>
<div id="progress-bar"></div><div id="lastupdated">Last updated: 1 Mar 2015</div><script src="../dzslides.js"></script><script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body></html>